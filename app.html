<!doctype html>
<html lang="fr" x-data="{}" x-init="$store.i18n.init('fr'); $store.seed.ensure()">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MA‑ACC — App</title>
  <script type="module" src="./src/app/main-app.js"></script>
</head>
<body class="bg-[var(--surface-alt)] text-[var(--ink)]" x-data="{ scrolled: false }" @scroll.window="scrolled = window.scrollY > 12">
  <div class="min-h-screen flex flex-col">
    <header class="sticky top-0 z-40">
      <div class="glass-panel mx-auto mt-4 flex w-[min(96%,1080px)] items-center justify-between gap-3 px-6 py-4 transition-all duration-[var(--duration-normal)]" :class="{'shadow-header': scrolled}">
        <div class="flex items-center gap-3">
          <button type="button" class="btn-ghost lg:hidden" aria-label="Menu" @click="$store.layout.sidebarOpen = true">
            <svg class="h-5 w-5" aria-hidden="true">
              <use href="./src/assets/icon-pack.svg#icon-menu"></use>
            </svg>
          </button>
          <a href="./index.html" class="flex items-center gap-3 rounded-[var(--radius-lg)] px-3 py-2 transition-all duration-[var(--duration-fast)] hover:bg-[var(--surface-hover)]">
            <span class="icon-circle">
              <img src="./src/assets/logo.svg" alt="MA-ACC" class="h-5 w-5" />
            </span>
            <span class="text-base font-bold tracking-tight">MA‑ACC Studio</span>
          </a>
        </div>
        <div class="flex items-center gap-2">
          <button type="button" class="btn-ghost hidden sm:flex" @click="$store.seed.reset()" title="Réinitialiser les données">
            <svg class="h-4 w-4" aria-hidden="true">
              <use href="./src/assets/icon-pack.svg#icon-refresh"></use>
            </svg>
            <span x-text="$store.i18n.t('global.resetData')"></span>
          </button>
          <button type="button" class="btn-ghost" @click="$store.i18n.toggle()" :title="$store.i18n.lang === 'fr' ? 'Basculer en arabe' : 'Switch to French'">
            <span class="font-bold" x-text="$store.i18n.lang === 'fr' ? 'FR' : 'AR'"></span>
          </button>
          <a href="./index.html" class="btn-outline hidden md:inline-flex" title="Retour à l'accueil">
            <svg class="h-4 w-4" aria-hidden="true">
              <use href="./src/assets/icon-pack.svg#icon-arrow-left"></use>
            </svg>
            <span x-text="$store.i18n.t('global.backLanding')"></span>
          </a>
        </div>
      </div>
    </header>

    <main class="flex-1">
      <div class="container-ma py-12">
        <div class="grid gap-6 lg:grid-cols-[minmax(0,280px)_minmax(0,1fr)]">
          <aside class="glass-panel hidden h-fit flex-col gap-6 px-5 py-7 lg:flex sticky top-24">
            <div class="space-y-2 px-3">
              <p class="text-xs font-bold uppercase tracking-[0.35em] text-[var(--ink-muted)]" x-text="$store.i18n.t('global.datasetInfo')"></p>
            </div>
            <nav
              class="space-y-2"
              x-data="{
                active: window.location.hash || '#/dashboard',
                items: [
                  { href: '#/dashboard', icon: 'analytics', key: 'nav.dashboard', fallback: 'Dashboard' },
                  { href: '#/sales', icon: 'invoice', key: 'nav.sales', fallback: 'Ventes' },
                  { href: '#/purchases', icon: 'cart', key: 'nav.purchases', fallback: 'Achats' },
                  { href: '#/bank', icon: 'bank', key: 'nav.bank', fallback: 'Banque' },
                  { href: '#/ledger', icon: 'double-entry', key: 'nav.ledger', fallback: 'Écritures' },
                  { href: '#/tax', icon: 'vat', key: 'nav.tax', fallback: 'TVA' },
                  { href: '#/payroll', icon: 'users', key: 'nav.payroll', fallback: 'Paie' },
                  { href: '#/fixed-assets', icon: 'report', key: 'nav.assets', fallback: 'Immobilisations' },
                  { href: '#/settings', icon: 'settings', key: 'nav.settings', fallback: 'Paramètres' }
                ],
                init(){
                  window.addEventListener('hashchange', () => {
                    const next = window.location.hash || '#/dashboard'
                    this.active = next
                  })
                }
              }"
            >
              <template x-for="item in items" :key="item.href">
                <a
                  :href="item.href"
                  class="flex items-center gap-3 rounded-[var(--radius-lg)] px-4 py-3.5 transition-all duration-[var(--duration-fast)] ease-[var(--ease-smooth)] group"
                  :class="active === item.href ? 'bg-[var(--surface)] text-[var(--ink)] font-semibold shadow-[var(--shadow-sm)]' : 'text-[var(--ink-soft)] hover:bg-[var(--surface-hover)] hover:text-[var(--ink)]'"
                  :aria-current="active === item.href ? 'page' : undefined"
                >
                  <span class="inline-flex h-10 w-10 items-center justify-center rounded-[var(--radius-md)] bg-[var(--surface-gloss)] shadow-[var(--shadow-xs)] transition-all duration-[var(--duration-fast)] group-hover:shadow-[var(--shadow-sm)]"
                        :class="active === item.href ? 'text-[var(--accent)] bg-[var(--accent-soft)]' : 'text-[var(--ink-muted)]'">
                    <svg class="h-5 w-5" aria-hidden="true">
                      <use :href="'./src/assets/icon-pack.svg#icon-' + item.icon"></use>
                    </svg>
                  </span>
                  <span class="text-sm" x-text="$store.i18n.t(item.key) || item.fallback"></span>
                </a>
              </template>
            </nav>
          </aside>

          <section class="glass-panel min-h-[70vh] p-8 md:p-10 rounded-[var(--radius-xl)]">
            <div id="view" data-router-view class="space-y-6" aria-live="polite"></div>
          </section>
        </div>
      </div>
    </main>
  </div>

  <div
    x-show="$store.layout.sidebarOpen"
    x-transition.opacity.duration.300ms
    class="fixed inset-0 z-50 flex items-start justify-end bg-black/40"
    style="backdrop-filter: blur(8px);"
    @click.self="$store.layout.closeSidebar()"
  >
    <div class="glass-panel h-full w-80 space-y-8 p-7 flex flex-col"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="translate-x-full"
         x-transition:enter-end="translate-x-0"
         x-transition:leave="transition ease-in duration-300"
         x-transition:leave-start="translate-x-0"
         x-transition:leave-end="translate-x-full">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <span class="inline-flex h-12 w-12 items-center justify-center rounded-[var(--radius-md)] bg-[var(--surface)] text-[var(--accent)] shadow-[var(--shadow-sm)]">
            <img src="./src/assets/logo.svg" alt="MA-ACC" class="h-6 w-6" />
          </span>
          <span class="text-lg font-bold tracking-tight">MA‑ACC</span>
        </div>
        <button type="button" class="btn-ghost" aria-label="Fermer le menu" @click="$store.layout.closeSidebar()">
          <svg class="h-5 w-5" aria-hidden="true">
            <use href="./src/assets/icon-pack.svg#icon-close"></use>
          </svg>
        </button>
      </div>
      <nav
        class="space-y-2 flex-1"
        x-data="{
          active: window.location.hash || '#/dashboard',
          items: [
            { href: '#/dashboard', icon: 'analytics', key: 'nav.dashboard', fallback: 'Dashboard' },
            { href: '#/sales', icon: 'invoice', key: 'nav.sales', fallback: 'Ventes' },
            { href: '#/purchases', icon: 'cart', key: 'nav.purchases', fallback: 'Achats' },
            { href: '#/bank', icon: 'bank', key: 'nav.bank', fallback: 'Banque' },
            { href: '#/ledger', icon: 'double-entry', key: 'nav.ledger', fallback: 'Écritures' },
            { href: '#/tax', icon: 'vat', key: 'nav.tax', fallback: 'TVA' },
            { href: '#/payroll', icon: 'users', key: 'nav.payroll', fallback: 'Paie' },
            { href: '#/fixed-assets', icon: 'report', key: 'nav.assets', fallback: 'Immobilisations' },
            { href: '#/settings', icon: 'settings', key: 'nav.settings', fallback: 'Paramètres' }
          ],
          init(){
            window.addEventListener('hashchange', () => {
              const next = window.location.hash || '#/dashboard'
              this.active = next
              window.Alpine?.store('layout')?.closeSidebar?.()
            })
          }
        }"
      >
        <template x-for="item in items" :key="item.href">
          <a
            :href="item.href"
            class="flex items-center gap-3 rounded-[var(--radius-lg)] px-4 py-3.5 transition-all duration-[var(--duration-fast)] ease-[var(--ease-smooth)] group"
            :class="active === item.href ? 'bg-[var(--surface)] text-[var(--ink)] font-semibold shadow-[var(--shadow-sm)]' : 'text-[var(--ink-soft)] hover:bg-[var(--surface-hover)] hover:text-[var(--ink)]'"
            :aria-current="active === item.href ? 'page' : undefined"
            @click="$store.layout.closeSidebar()"
          >
            <span class="inline-flex h-10 w-10 items-center justify-center rounded-[var(--radius-md)] bg-[var(--surface-gloss)] shadow-[var(--shadow-xs)] transition-all duration-[var(--duration-fast)] group-hover:shadow-[var(--shadow-sm)]"
                  :class="active === item.href ? 'text-[var(--accent)] bg-[var(--accent-soft)]' : 'text-[var(--ink-muted)]'">
              <svg class="h-5 w-5" aria-hidden="true">
                <use :href="'./src/assets/icon-pack.svg#icon-' + item.icon"></use>
              </svg>
            </span>
            <span class="text-sm" x-text="$store.i18n.t(item.key) || item.fallback"></span>
          </a>
        </template>
      </nav>
      <div class="space-y-4 border-t-2 border-[var(--divider)] pt-6">
        <p class="text-xs font-bold uppercase tracking-[0.35em] text-[var(--ink-muted)]" x-text="$store.i18n.t('global.datasetInfo')"></p>
        <button type="button" class="btn-outline w-full justify-center" @click="$store.seed.reset(); $store.layout.closeSidebar()" x-text="$store.i18n.t('global.resetAction')"></button>
      </div>
    </div>
  </div>

  <div class="toast-stack" x-data x-cloak>
    <template x-for="toast in $store.toast.items" :key="toast.id">
      <div
        class="toast"
        :class="{
          'border-[var(--success)] bg-[var(--success-soft)]': toast.type === 'success',
          'border-[var(--danger)] bg-[var(--danger-soft)] text-[var(--danger)]': toast.type === 'error',
          'border-[var(--warning)] bg-[var(--warning-soft)]': toast.type === 'warning',
          'border-[var(--info)] bg-[var(--info-soft)]': toast.type === 'info'
        }"
        role="alert"
        aria-live="assertive"
      >
        <div class="flex-1 min-w-0">
          <p class="text-sm font-bold" x-text="toast.title"></p>
          <p class="mt-1 text-xs text-[var(--ink-soft)] line-clamp-2" x-text="toast.message"></p>
        </div>
        <button type="button" class="btn-ghost btn-sm flex-shrink-0" @click="$store.toast.dismiss(toast.id)" aria-label="Fermer la notification">
          <svg class="h-4 w-4" aria-hidden="true">
            <use href="./src/assets/icon-pack.svg#icon-close"></use>
          </svg>
        </button>
      </div>
    </template>
  </div>
</body>
</html>
