<!doctype html>
<html lang="fr" x-data="{}" x-init="$store.i18n.init('fr'); $store.seed.ensure()">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MA‑ACC — App</title>
  <script type="module" src="./src/app/main-app.js"></script>
</head>
<body class="bg-[var(--surface-alt)] text-[var(--ink)]" x-data="{ scrolled: false }" @scroll.window="scrolled = window.scrollY > 12">
  <div class="min-h-screen flex flex-col">
    <header class="sticky top-0 z-40">
      <div class="glass-panel mx-auto mt-3 flex w-[min(96%,1080px)] items-center justify-between gap-3 px-5 py-3 transition" :class="{'shadow-header': scrolled}">
        <div class="flex items-center gap-2">
          <button type="button" class="btn-ghost lg:hidden" aria-label="Menu" @click="$store.layout.sidebarOpen = true">
            <svg class="h-5 w-5" aria-hidden="true">
              <use href="./src/assets/icon-pack.svg#icon-menu"></use>
            </svg>
          </button>
          <a href="./index.html" class="flex items-center gap-3 rounded-full px-2 py-1 transition hover:bg-white/70">
            <span class="icon-circle">
              <img src="./src/assets/logo.svg" alt="MA-ACC" class="h-5 w-5" />
            </span>
            <span class="text-base font-semibold">MA‑ACC Studio</span>
          </a>
        </div>
        <div class="flex items-center gap-2">
          <button type="button" class="btn-ghost hidden sm:flex" @click="$store.seed.reset()">
            <svg class="h-4 w-4" aria-hidden="true">
              <use href="./src/assets/icon-pack.svg#icon-refresh"></use>
            </svg>
            <span x-text="$store.i18n.t('global.resetData')"></span>
          </button>
          <button type="button" class="btn-ghost" @click="$store.i18n.toggle()">
            <span class="font-semibold" x-text="$store.i18n.lang === 'fr' ? 'FR' : 'AR'"></span>
          </button>
          <a href="./index.html" class="btn-outline hidden md:inline-flex gap-2">
            <svg class="h-4 w-4" aria-hidden="true">
              <use href="./src/assets/icon-pack.svg#icon-arrow-left"></use>
            </svg>
            <span x-text="$store.i18n.t('global.backLanding')"></span>
          </a>
        </div>
      </div>
    </header>

    <main class="flex-1">
      <div class="container-ma py-10">
        <div class="grid gap-6 lg:grid-cols-[minmax(0,280px)_minmax(0,1fr)]">
          <aside class="glass-panel hidden h-fit flex-col gap-4 px-4 py-6 lg:flex">
            <div class="space-y-2 px-2">
              <p class="eyebrow" x-text="$store.i18n.t('global.datasetInfo')"></p>
            </div>
            <nav
              class="space-y-1"
              x-data="{
                active: window.location.hash || '#/dashboard',
                items: [
                  { href: '#/dashboard', icon: 'analytics', key: 'nav.dashboard', fallback: 'Dashboard' },
                  { href: '#/sales', icon: 'invoice', key: 'nav.sales', fallback: 'Ventes' },
                  { href: '#/purchases', icon: 'cart', key: 'nav.purchases', fallback: 'Achats' },
                  { href: '#/bank', icon: 'bank', key: 'nav.bank', fallback: 'Banque' },
                  { href: '#/ledger', icon: 'double-entry', key: 'nav.ledger', fallback: 'Écritures' },
                  { href: '#/tax', icon: 'vat', key: 'nav.tax', fallback: 'TVA' },
                  { href: '#/payroll', icon: 'users', key: 'nav.payroll', fallback: 'Paie' },
                  { href: '#/fixed-assets', icon: 'report', key: 'nav.assets', fallback: 'Immobilisations' },
                  { href: '#/settings', icon: 'settings', key: 'nav.settings', fallback: 'Paramètres' }
                ],
                init(){
                  window.addEventListener('hashchange', () => {
                    const next = window.location.hash || '#/dashboard'
                    this.active = next
                  })
                }
              }"
            >
              <template x-for="item in items" :key="item.href">
                <a
                  :href="item.href"
                  class="flex items-center gap-3 rounded-[18px] px-4 py-3 transition"
                  :class="active === item.href ? 'bg-white text-[var(--ink)] shadow-sm' : 'text-[var(--ink)] text-opacity-70 hover:bg-white/80 hover:text-[var(--ink)] hover:text-opacity-100'"
                  :aria-current="active === item.href ? 'page' : undefined"
                >
                  <span class="inline-flex h-9 w-9 items-center justify-center rounded-full bg-white/70 text-[var(--accent)] shadow-sm">
                    <svg class="h-5 w-5" aria-hidden="true">
                      <use :href="'./src/assets/icon-pack.svg#icon-' + item.icon"></use>
                    </svg>
                  </span>
                  <span x-text="$store.i18n.t(item.key) || item.fallback"></span>
                </a>
              </template>
            </nav>
          </aside>

          <section class="glass-panel min-h-[70vh] p-6 md:p-8">
            <div id="view" data-router-view class="space-y-6" aria-live="polite"></div>
          </section>
        </div>
      </div>
    </main>
  </div>

  <div
    x-show="$store.layout.sidebarOpen"
    x-transition.opacity
    class="fixed inset-0 z-50 flex items-start justify-end bg-black/40 backdrop-blur-sm"
    @click.self="$store.layout.closeSidebar()"
  >
    <div class="glass-panel h-full w-80 space-y-6 p-6">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <span class="icon-circle">
            <img src="./src/assets/logo.svg" alt="MA-ACC" class="h-5 w-5" />
          </span>
          <span class="text-base font-semibold">MA‑ACC</span>
        </div>
        <button type="button" class="btn-ghost" aria-label="Fermer" @click="$store.layout.closeSidebar()">
          <svg class="h-4 w-4" aria-hidden="true">
            <use href="./src/assets/icon-pack.svg#icon-close"></use>
          </svg>
        </button>
      </div>
      <nav
        class="space-y-1 text-base"
        x-data="{
          active: window.location.hash || '#/dashboard',
          items: [
            { href: '#/dashboard', icon: 'analytics', key: 'nav.dashboard', fallback: 'Dashboard' },
            { href: '#/sales', icon: 'invoice', key: 'nav.sales', fallback: 'Ventes' },
            { href: '#/purchases', icon: 'cart', key: 'nav.purchases', fallback: 'Achats' },
            { href: '#/bank', icon: 'bank', key: 'nav.bank', fallback: 'Banque' },
            { href: '#/ledger', icon: 'double-entry', key: 'nav.ledger', fallback: 'Écritures' },
            { href: '#/tax', icon: 'vat', key: 'nav.tax', fallback: 'TVA' },
            { href: '#/payroll', icon: 'users', key: 'nav.payroll', fallback: 'Paie' },
            { href: '#/fixed-assets', icon: 'report', key: 'nav.assets', fallback: 'Immobilisations' },
            { href: '#/settings', icon: 'settings', key: 'nav.settings', fallback: 'Paramètres' }
          ],
          init(){
            window.addEventListener('hashchange', () => {
              const next = window.location.hash || '#/dashboard'
              this.active = next
              window.Alpine?.store('layout')?.closeSidebar?.()
            })
          }
        }"
      >
        <template x-for="item in items" :key="item.href">
          <a
            :href="item.href"
            class="flex items-center gap-3 rounded-[18px] px-4 py-3 transition"
            :class="active === item.href ? 'bg-white text-[var(--ink)] shadow-sm' : 'text-[var(--ink)] text-opacity-70 hover:bg-white/80 hover:text-[var(--ink)] hover:text-opacity-100'"
            :aria-current="active === item.href ? 'page' : undefined"
            @click="$store.layout.closeSidebar()"
          >
            <span class="inline-flex h-9 w-9 items-center justify-center rounded-full bg-white/70 text-[var(--accent)] shadow-sm">
              <svg class="h-5 w-5" aria-hidden="true">
                <use :href="'./src/assets/icon-pack.svg#icon-' + item.icon"></use>
              </svg>
            </span>
            <span x-text="$store.i18n.t(item.key) || item.fallback"></span>
          </a>
        </template>
      </nav>
      <div class="mt-auto space-y-3 border-t border-[var(--divider)] pt-4 text-sm text-[var(--ink-muted)]">
        <p x-text="$store.i18n.t('global.datasetInfo')"></p>
        <button type="button" class="btn-outline w-full justify-center" @click="$store.seed.reset(); $store.layout.closeSidebar()" x-text="$store.i18n.t('global.resetAction')"></button>
      </div>
    </div>
  </div>

  <div class="toast-stack" x-data x-cloak>
    <template x-for="toast in $store.toast.items" :key="toast.id">
      <div
        class="toast-item"
        :class="{
          'border-[color:rgba(52,199,89,0.4)] bg-[color:rgba(52,199,89,0.14)]': toast.type === 'success',
          'border-[color:rgba(255,59,48,0.4)] bg-[color:rgba(255,59,48,0.14)] text-[color:#ff3b30]': toast.type === 'error',
          'border-[color:rgba(245,166,35,0.35)] bg-[color:rgba(245,166,35,0.14)]': toast.type === 'warning',
          'border-[var(--divider)] bg-white': toast.type === 'info'
        }"
      >
        <div class="flex-1">
          <p class="text-sm font-semibold" x-text="toast.title"></p>
          <p class="mt-1 text-xs text-[var(--ink-soft)]" x-text="toast.message"></p>
        </div>
        <button type="button" class="btn-ghost btn-sm" @click="$store.toast.dismiss(toast.id)">
          <svg class="h-4 w-4" aria-hidden="true">
            <use href="./src/assets/icon-pack.svg#icon-close"></use>
          </svg>
        </button>
      </div>
    </template>
  </div>
</body>
</html>
