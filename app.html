<!doctype html>
<html lang="fr" x-data="{}" x-init="$store.i18n.init('fr'); $store.seed.ensure()">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MA‑ACC — App</title>
  <script type="module" src="./src/app/main-app.js"></script>
</head>
<body class="bg-[var(--surface-alt)] text-[var(--ink)]" x-data="{ scrolled: false }" @scroll.window="scrolled = window.scrollY > 12">
  <div class="min-h-screen flex">
    <!-- Modern Sidebar for Desktop -->
    <aside class="hidden lg:flex lg:flex-col lg:w-72 lg:fixed lg:inset-y-0 bg-white border-r border-[var(--divider)]">
      <!-- Sidebar Header -->
      <div class="flex items-center gap-3 h-20 px-6 border-b border-[var(--divider)]">
        <div class="flex items-center gap-3">
          <div class="flex h-10 w-10 items-center justify-center rounded-[var(--radius-md)] bg-gradient-to-br from-[var(--primary)] to-[var(--primary-light)] shadow-[var(--shadow-md)]">
            <img src="./src/assets/logo.svg" alt="MA-ACC" class="h-6 w-6 brightness-0 invert" />
          </div>
          <div>
            <h1 class="text-lg font-bold tracking-tight text-[var(--ink)]">MA‑ACC</h1>
            <p class="text-xs text-[var(--ink-muted)]">Studio Pro</p>
          </div>
        </div>
      </div>

      <!-- Navigation -->
      <nav
        class="flex-1 px-4 py-6 space-y-1.5 overflow-y-auto"
        x-data="{
          active: window.location.hash || '#/dashboard',
          items: [
            { href: '#/dashboard', icon: 'analytics', key: 'nav.dashboard', fallback: 'Dashboard', color: 'primary' },
            { href: '#/sales', icon: 'invoice', key: 'nav.sales', fallback: 'Ventes', color: 'success' },
            { href: '#/purchases', icon: 'cart', key: 'nav.purchases', fallback: 'Achats', color: 'warning' },
            { href: '#/bank', icon: 'bank', key: 'nav.bank', fallback: 'Banque', color: 'accent' },
            { href: '#/ledger', icon: 'double-entry', key: 'nav.ledger', fallback: 'Écritures', color: 'primary' },
            { href: '#/tax', icon: 'vat', key: 'nav.tax', fallback: 'TVA', color: 'danger' },
            { href: '#/payroll', icon: 'users', key: 'nav.payroll', fallback: 'Paie', color: 'info' },
            { href: '#/fixed-assets', icon: 'report', key: 'nav.assets', fallback: 'Immobilisations', color: 'warning' },
            { href: '#/settings', icon: 'settings', key: 'nav.settings', fallback: 'Paramètres', color: 'primary' }
          ],
          init(){
            window.addEventListener('hashchange', () => {
              const next = window.location.hash || '#/dashboard'
              this.active = next
            })
          }
        }"
      >
        <template x-for="item in items" :key="item.href">
          <a
            :href="item.href"
            class="flex items-center gap-3.5 rounded-[var(--radius-lg)] px-4 py-3 transition-all duration-[var(--duration-fast)] group relative"
            :class="active === item.href
              ? 'bg-[var(--primary-soft)] text-[var(--primary)] font-semibold shadow-sm'
              : 'text-[var(--ink-soft)] hover:bg-[var(--surface-hover)] hover:text-[var(--ink)]'"
            :aria-current="active === item.href ? 'page' : undefined"
          >
            <!-- Active indicator -->
            <span
              class="absolute left-0 top-1/2 -translate-y-1/2 w-1 h-8 bg-[var(--primary)] rounded-r-full transition-all duration-[var(--duration-fast)]"
              :class="active === item.href ? 'opacity-100' : 'opacity-0'"
            ></span>

            <span
              class="flex h-9 w-9 items-center justify-center rounded-[var(--radius-md)] transition-all duration-[var(--duration-fast)]"
              :class="active === item.href ? 'bg-[var(--primary)] text-white shadow-md' : 'bg-[var(--surface-alt)] text-[var(--ink-muted)] group-hover:bg-[var(--surface)]'"
            >
              <svg class="h-5 w-5" aria-hidden="true">
                <use :href="'./src/assets/icon-pack.svg#icon-' + item.icon"></use>
              </svg>
            </span>
            <span class="text-sm font-medium" x-text="$store.i18n.t(item.key) || item.fallback"></span>
          </a>
        </template>
      </nav>

      <!-- Sidebar Footer -->
      <div class="px-4 py-4 border-t border-[var(--divider)] space-y-3">
        <button
          type="button"
          class="w-full flex items-center gap-3 px-4 py-2.5 rounded-[var(--radius-lg)] text-sm font-medium text-[var(--ink-soft)] hover:bg-[var(--surface-hover)] hover:text-[var(--ink)] transition-all duration-[var(--duration-fast)]"
          @click="$store.i18n.toggle()"
          :title="$store.i18n.lang === 'fr' ? 'Basculer en arabe' : 'Switch to French'"
        >
          <svg class="h-5 w-5" aria-hidden="true">
            <use href="./src/assets/icon-pack.svg#icon-double-entry"></use>
          </svg>
          <span x-text="$store.i18n.lang === 'fr' ? 'Français' : 'العربية'"></span>
        </button>
      </div>
    </aside>

    <!-- Main Content Area -->
    <div class="flex-1 lg:pl-72">
      <!-- Top Header Bar -->
      <header class="sticky top-0 z-40 bg-white/80 backdrop-blur-xl border-b border-[var(--divider)]">
        <div class="flex items-center justify-between h-20 px-4 sm:px-6 lg:px-8">
          <!-- Mobile menu button -->
          <button
            type="button"
            class="lg:hidden btn-ghost"
            aria-label="Menu"
            @click="$store.layout.sidebarOpen = true"
          >
            <svg class="h-6 w-6" aria-hidden="true">
              <use href="./src/assets/icon-pack.svg#icon-menu"></use>
            </svg>
          </button>

          <!-- Logo for mobile -->
          <a href="./index.html" class="lg:hidden flex items-center gap-2">
            <div class="flex h-9 w-9 items-center justify-center rounded-[var(--radius-md)] bg-gradient-to-br from-[var(--primary)] to-[var(--primary-light)]">
              <img src="./src/assets/logo.svg" alt="MA-ACC" class="h-5 w-5 brightness-0 invert" />
            </div>
            <span class="text-base font-bold tracking-tight">MA‑ACC</span>
          </a>

          <!-- Search Bar (placeholder for future) -->
          <div class="hidden lg:flex flex-1 max-w-lg mx-8">
            <div class="relative w-full">
              <input
                type="search"
                placeholder="Rechercher..."
                class="w-full pl-10 pr-4 py-2.5 rounded-[var(--radius-full)] bg-[var(--surface-alt)] border border-[var(--divider)] text-sm focus:outline-none focus:ring-2 focus:ring-[var(--primary)] focus:border-transparent transition-all"
              />
              <svg class="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-[var(--ink-muted)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
              </svg>
            </div>
          </div>

          <!-- Header Actions -->
          <div class="flex items-center gap-2">
            <button
              type="button"
              class="btn-ghost hidden sm:inline-flex"
              @click="$store.seed.reset()"
              title="Réinitialiser les données"
            >
              <svg class="h-5 w-5" aria-hidden="true">
                <use href="./src/assets/icon-pack.svg#icon-refresh"></use>
              </svg>
            </button>

            <a
              href="./index.html"
              class="btn-outline hidden md:inline-flex"
              title="Retour à l'accueil"
            >
              <svg class="h-4 w-4" aria-hidden="true">
                <use href="./src/assets/icon-pack.svg#icon-arrow-left"></use>
              </svg>
              <span x-text="$store.i18n.t('global.backLanding')"></span>
            </a>
          </div>
        </div>
      </header>

      <!-- Page Content -->
      <main class="p-4 sm:p-6 lg:p-8">
        <div id="view" data-router-view class="animate-fade-in-up" aria-live="polite"></div>
      </main>
    </div>
  </div>

  <!-- Mobile Sidebar -->
  <div
    x-show="$store.layout.sidebarOpen"
    x-transition.opacity.duration.300ms
    class="lg:hidden fixed inset-0 z-50 flex bg-black/50 backdrop-blur-sm"
    @click.self="$store.layout.closeSidebar()"
  >
    <div
      class="w-80 h-full bg-white shadow-2xl flex flex-col"
      x-transition:enter="transition ease-out duration-300"
      x-transition:enter-start="-translate-x-full"
      x-transition:enter-end="translate-x-0"
      x-transition:leave="transition ease-in duration-300"
      x-transition:leave-start="translate-x-0"
      x-transition:leave-end="-translate-x-full"
    >
      <!-- Mobile Sidebar Header -->
      <div class="flex items-center justify-between h-20 px-6 border-b border-[var(--divider)]">
        <div class="flex items-center gap-3">
          <div class="flex h-10 w-10 items-center justify-center rounded-[var(--radius-md)] bg-gradient-to-br from-[var(--primary)] to-[var(--primary-light)] shadow-[var(--shadow-md)]">
            <img src="./src/assets/logo.svg" alt="MA-ACC" class="h-6 w-6 brightness-0 invert" />
          </div>
          <div>
            <h1 class="text-lg font-bold tracking-tight text-[var(--ink)]">MA‑ACC</h1>
            <p class="text-xs text-[var(--ink-muted)]">Studio Pro</p>
          </div>
        </div>
        <button type="button" class="btn-ghost p-2" aria-label="Fermer le menu" @click="$store.layout.closeSidebar()">
          <svg class="h-6 w-6" aria-hidden="true">
            <use href="./src/assets/icon-pack.svg#icon-close"></use>
          </svg>
        </button>
      </div>

      <!-- Mobile Navigation -->
      <nav
        class="flex-1 px-4 py-6 space-y-1.5 overflow-y-auto"
        x-data="{
          active: window.location.hash || '#/dashboard',
          items: [
            { href: '#/dashboard', icon: 'analytics', key: 'nav.dashboard', fallback: 'Dashboard' },
            { href: '#/sales', icon: 'invoice', key: 'nav.sales', fallback: 'Ventes' },
            { href: '#/purchases', icon: 'cart', key: 'nav.purchases', fallback: 'Achats' },
            { href: '#/bank', icon: 'bank', key: 'nav.bank', fallback: 'Banque' },
            { href: '#/ledger', icon: 'double-entry', key: 'nav.ledger', fallback: 'Écritures' },
            { href: '#/tax', icon: 'vat', key: 'nav.tax', fallback: 'TVA' },
            { href: '#/payroll', icon: 'users', key: 'nav.payroll', fallback: 'Paie' },
            { href: '#/fixed-assets', icon: 'report', key: 'nav.assets', fallback: 'Immobilisations' },
            { href: '#/settings', icon: 'settings', key: 'nav.settings', fallback: 'Paramètres' }
          ],
          init(){
            window.addEventListener('hashchange', () => {
              const next = window.location.hash || '#/dashboard'
              this.active = next
              window.Alpine?.store('layout')?.closeSidebar?.()
            })
          }
        }"
      >
        <template x-for="item in items" :key="item.href">
          <a
            :href="item.href"
            class="flex items-center gap-3.5 rounded-[var(--radius-lg)] px-4 py-3 transition-all duration-[var(--duration-fast)] group relative"
            :class="active === item.href
              ? 'bg-[var(--primary-soft)] text-[var(--primary)] font-semibold'
              : 'text-[var(--ink-soft)] hover:bg-[var(--surface-hover)] hover:text-[var(--ink)]'"
            :aria-current="active === item.href ? 'page' : undefined"
            @click="$store.layout.closeSidebar()"
          >
            <span
              class="absolute left-0 top-1/2 -translate-y-1/2 w-1 h-8 bg-[var(--primary)] rounded-r-full transition-all duration-[var(--duration-fast)]"
              :class="active === item.href ? 'opacity-100' : 'opacity-0'"
            ></span>

            <span
              class="flex h-9 w-9 items-center justify-center rounded-[var(--radius-md)] transition-all duration-[var(--duration-fast)]"
              :class="active === item.href ? 'bg-[var(--primary)] text-white shadow-md' : 'bg-[var(--surface-alt)] text-[var(--ink-muted)]'"
            >
              <svg class="h-5 w-5" aria-hidden="true">
                <use :href="'./src/assets/icon-pack.svg#icon-' + item.icon"></use>
              </svg>
            </span>
            <span class="text-sm font-medium" x-text="$store.i18n.t(item.key) || item.fallback"></span>
          </a>
        </template>
      </nav>

      <!-- Mobile Sidebar Footer -->
      <div class="px-4 py-4 border-t border-[var(--divider)] space-y-3">
        <button
          type="button"
          class="w-full flex items-center gap-3 px-4 py-2.5 rounded-[var(--radius-lg)] text-sm font-medium text-[var(--ink-soft)] hover:bg-[var(--surface-hover)] hover:text-[var(--ink)] transition-all duration-[var(--duration-fast)]"
          @click="$store.i18n.toggle()"
        >
          <svg class="h-5 w-5" aria-hidden="true">
            <use href="./src/assets/icon-pack.svg#icon-double-entry"></use>
          </svg>
          <span x-text="$store.i18n.lang === 'fr' ? 'Français' : 'العربية'"></span>
        </button>
        <button
          type="button"
          class="w-full btn-outline justify-center"
          @click="$store.seed.reset(); $store.layout.closeSidebar()"
          x-text="$store.i18n.t('global.resetAction')"
        ></button>
      </div>
    </div>
  </div>

  <div class="toast-stack" x-data x-cloak>
    <template x-for="toast in $store.toast.items" :key="toast.id">
      <div
        class="toast"
        :class="{
          'border-[var(--success)] bg-[var(--success-soft)]': toast.type === 'success',
          'border-[var(--danger)] bg-[var(--danger-soft)] text-[var(--danger)]': toast.type === 'error',
          'border-[var(--warning)] bg-[var(--warning-soft)]': toast.type === 'warning',
          'border-[var(--info)] bg-[var(--info-soft)]': toast.type === 'info'
        }"
        role="alert"
        aria-live="assertive"
      >
        <div class="flex-1 min-w-0">
          <p class="text-sm font-bold" x-text="toast.title"></p>
          <p class="mt-1 text-xs text-[var(--ink-soft)] line-clamp-2" x-text="toast.message"></p>
        </div>
        <button type="button" class="btn-ghost btn-sm flex-shrink-0" @click="$store.toast.dismiss(toast.id)" aria-label="Fermer la notification">
          <svg class="h-4 w-4" aria-hidden="true">
            <use href="./src/assets/icon-pack.svg#icon-close"></use>
          </svg>
        </button>
      </div>
    </template>
  </div>
</body>
</html>
